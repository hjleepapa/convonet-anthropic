{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header Section -->
    <section class="py-16 bg-white">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">LGCH Todo System</h1>
                <p class="text-xl text-gray-600 mb-8">LangGraph + Twilio + MCP + LangChain Voice AI agentic solution</p>
                <div class="flex justify-center space-x-4">
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">Flask</span>
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">LangGraph</span>
                    <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">MCP</span>
                    <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">LangChain</span>
                    <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">OpenAI</span>
                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium">Google Calendar</span>
                    <span class="bg-pink-100 text-pink-800 px-3 py-1 rounded-full text-sm font-medium">Twilio</span>
                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium">ngrok</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Technical Architecture Section -->
    <section class="py-16 bg-white">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-center mb-12">Technical Architecture</h2>
            
            <!-- System Architecture Overview -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">System Architecture Overview</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <!-- Overall System Architecture Diagram -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">LGCH Todo System Architecture</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <!-- Frontend Layer -->
                                <div class="space-y-4">
                                    <h5 class="text-sm font-bold text-gray-800 text-center">Frontend Layer</h5>
                                    <div class="space-y-2">
                                        <div class="bg-blue-100 border border-blue-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-blue-800">Web Interface</div>
                                            <div class="text-xs text-blue-600">Flask Templates</div>
                                        </div>
                                        <div class="bg-green-100 border border-green-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-green-800">Voice Interface</div>
                                            <div class="text-xs text-green-600">Terminal/Phone</div>
                                        </div>
                                        <div class="bg-purple-100 border border-purple-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-purple-800">Phone Calls</div>
                                            <div class="text-xs text-purple-600">Twilio Integration</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Core Processing Layer -->
                                <div class="space-y-4">
                                    <h5 class="text-sm font-bold text-gray-800 text-center">Core Processing Layer</h5>
                                    <div class="space-y-2">
                                        <div class="bg-orange-100 border border-orange-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-orange-800">LangGraph Agent</div>
                                            <div class="text-xs text-orange-600">Luna AI Assistant</div>
                                        </div>
                                        <div class="bg-yellow-100 border border-yellow-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-yellow-800">MCP Tools</div>
                                            <div class="text-xs text-yellow-600">Database & Calendar</div>
                                        </div>
                                        <div class="bg-pink-100 border border-pink-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-pink-800">WebSocket Server</div>
                                            <div class="text-xs text-pink-600">Real-time Communication</div>
                                        </div>
                                        <div class="bg-indigo-100 border border-indigo-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-indigo-800">Flask API</div>
                                            <div class="text-xs text-indigo-600">REST Endpoints</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- External Services Layer -->
                                <div class="space-y-4">
                                    <h5 class="text-sm font-bold text-gray-800 text-center">External Services Layer</h5>
                                    <div class="space-y-2">
                                        <div class="bg-red-100 border border-red-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-red-800">OpenAI APIs</div>
                                            <div class="text-xs text-red-600">GPT-4, Whisper, TTS</div>
                                        </div>
                                        <div class="bg-gray-100 border border-gray-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-gray-800">PostgreSQL</div>
                                            <div class="text-xs text-gray-600">Data Storage</div>
                                        </div>
                                        <div class="bg-blue-100 border border-blue-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-blue-800">Google Calendar</div>
                                            <div class="text-xs text-blue-600">Event Sync</div>
                                        </div>
                                        <div class="bg-cyan-100 border border-cyan-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-cyan-800">ngrok Tunnels</div>
                                            <div class="text-xs text-cyan-600">Secure Webhooks</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Data Flow Arrows -->
                            <div class="mt-6 space-y-2">
                                <div class="flex justify-center">
                                    <div class="text-xs text-gray-600 bg-gray-100 px-3 py-1 rounded">
                                        ‚Üê User Input (Voice/Web) ‚Üí LangGraph Processing ‚Üí MCP Tools ‚Üí External APIs ‚Üí Response
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Architecture Flow:</strong> Multi-layered system with voice/web interfaces, AI processing, and external service integration for comprehensive productivity management.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Overview -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Overview</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        The LGCH Todo System leverages the power of LangGraph, Model Context Protocol (MCP), and LangChain to create an intelligent voice-enabled AI assistant named Luna. 
                        This system demonstrates advanced agent architecture with tool-calling capabilities, state management, and seamless integration with external services.
                        <br><br>
                        Luna can manage to-do tasks, reminders, and calendar events through natural voice interactions or web API calls. 
                        All data is stored in a PostgreSQL database and automatically synchronized with Google Calendar, 
                        providing a comprehensive productivity management solution.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Core Technologies</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>‚Ä¢ LangGraph for agent orchestration</li>
                                <li>‚Ä¢ Model Context Protocol (MCP) for tool management</li>
                                <li>‚Ä¢ LangChain for LLM integration</li>
                                <li>‚Ä¢ Flask for web API endpoints</li>
                                <li>‚Ä¢ SQLAlchemy for database operations</li>
                                <li>‚Ä¢ OpenAI APIs (GPT-4, Whisper, TTS)</li>
                                <li>‚Ä¢ Twilio for phone integration</li>
                                <li>‚Ä¢ ngrok for secure tunneling</li>
                                <li>‚Ä¢ WebSocket for real-time communication</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Key Features</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>‚Ä¢ Voice-enabled AI assistant (Luna)</li>
                                <li>‚Ä¢ Todo list management with priorities</li>
                                <li>‚Ä¢ Reminder system with importance levels</li>
                                <li>‚Ä¢ Calendar event management</li>
                                <li>‚Ä¢ Google Calendar integration</li>
                                <li>‚Ä¢ RESTful API endpoints</li>
                                <li>‚Ä¢ Real-time voice interaction</li>
                                <li>‚Ä¢ Twilio phone integration</li>
                                <li>‚Ä¢ ngrok tunnel management</li>
                                <li>‚Ä¢ WebSocket real-time communication</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module Structure -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Module Structure</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex justify-center">
                        <div class="bg-white p-4 rounded border max-w-2xl">
                            <h4 class="font-semibold text-gray-800 mb-3">LGCH Todo System Structure</h4>
                            <div class="font-mono text-sm overflow-x-auto">
                                <pre>Project Root/
‚îú‚îÄ‚îÄ app.py                   # Main Flask application
‚îú‚îÄ‚îÄ start_servers.py         # Production server startup script
‚îú‚îÄ‚îÄ setup_ngrok_tunnels.py   # ngrok tunnel management
‚îú‚îÄ‚îÄ ngrok.yml               # ngrok configuration file
‚îú‚îÄ‚îÄ requirements.txt        # Python dependencies
‚îú‚îÄ‚îÄ recordings/             # Call recording storage (git-ignored)
‚îî‚îÄ‚îÄ lgch_todo/              # LGCH Todo module
    ‚îú‚îÄ‚îÄ __init__.py         # Package initialization, exports blueprint
    ‚îú‚îÄ‚îÄ routes.py           # Flask routes and Twilio webhooks
    ‚îú‚îÄ‚îÄ http_websocket_server.py # Hybrid HTTP/WebSocket server
    ‚îú‚îÄ‚îÄ twilio_handler.py   # Twilio Media Streams handler
    ‚îú‚îÄ‚îÄ assistant_graph_todo.py # LangGraph agent definition
    ‚îú‚îÄ‚îÄ state.py            # Agent state management
    ‚îú‚îÄ‚îÄ voice_utils.py      # Audio recording and playback
    ‚îú‚îÄ‚îÄ templates/          # Flask templates
‚îÇ   ‚îî‚îÄ‚îÄ lgch_todo_index.html
    ‚îî‚îÄ‚îÄ mcps/               # Model Context Protocol servers
        ‚îú‚îÄ‚îÄ mcp_config.json # MCP server configuration
    ‚îî‚îÄ‚îÄ local_servers/
            ‚îú‚îÄ‚îÄ db_todo.py  # Database operations via MCP
            ‚îî‚îÄ‚îÄ google_calendar.py # Calendar operations via MCP</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LangGraph Architecture -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">LangGraph Agent Architecture</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <!-- LangGraph Workflow Diagram -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">LangGraph Workflow Diagram</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="flex justify-center">
                                <img src="/lgch_todo/static/assets/img/lgwfdg.png" 
                                     alt="LangGraph Workflow Diagram" 
                                     class="max-w-full h-auto rounded-lg shadow-lg"
                                     style="max-width: 800px; height: auto;">
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>LangGraph Workflow:</strong> The agent can either continue to use tools or end the conversation based on user input and context.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-3">Agent Components</h4>
                            <ul class="text-sm text-gray-600 space-y-2">
                                <li>‚Ä¢ <strong>TodoAgent Class:</strong> Main agent orchestrator</li>
                                <li>‚Ä¢ <strong>StateGraph:</strong> Manages conversation flow</li>
                                <li>‚Ä¢ <strong>Assistant Node:</strong> LLM reasoning and response generation</li>
                                <li>‚Ä¢ <strong>Tool Node:</strong> Executes MCP tools</li>
                                <li>‚Ä¢ <strong>Conditional Edges:</strong> Routes between nodes based on tool calls</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-3">State Management</h4>
                            <ul class="text-sm text-gray-600 space-y-2">
                                <li>‚Ä¢ <strong>AgentState:</strong> Conversation state with message history</li>
                                <li>‚Ä¢ <strong>Message History:</strong> Maintains conversation context</li>
                                <li>‚Ä¢ <strong>Customer ID:</strong> User identification</li>
                                <li>‚Ä¢ <strong>Checkpointer:</strong> InMemorySaver for state persistence</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MCP Integration -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Model Context Protocol (MCP) Integration</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        MCP provides a standardized way for AI agents to interact with external tools and services. 
                        The LGCH system uses MCP to expose database operations and Google Calendar integration as tools.
                    </p>
                    
                    <!-- MCP Tool Flow Diagram -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">MCP Tool Integration Flow</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="flex justify-center items-center space-x-8">
                                <!-- LangGraph Agent -->
                                <div class="text-center">
                                    <div class="w-20 h-16 bg-orange-100 border-2 border-orange-300 rounded-lg flex items-center justify-center mb-2">
                                        <span class="text-orange-800 font-bold text-xs">LangGraph<br>Agent</span>
                                    </div>
                                    <div class="text-xs text-gray-600">Luna AI</div>
                                </div>
                                
                                <!-- Arrow -->
                                <div class="flex-1 h-0.5 bg-gray-400 relative">
                                    <div class="absolute right-0 top-0 w-0 h-0 border-l-4 border-l-gray-400 border-t-2 border-b-2 border-t-transparent border-b-transparent transform -translate-y-1"></div>
                                </div>
                                
                                <!-- MCP Client -->
                                <div class="text-center">
                                    <div class="w-20 h-16 bg-purple-100 border-2 border-purple-300 rounded-lg flex items-center justify-center mb-2">
                                        <span class="text-purple-800 font-bold text-xs">MCP<br>Client</span>
                                    </div>
                                    <div class="text-xs text-gray-600">Tool Manager</div>
                                </div>
                                
                                <!-- Arrow -->
                                <div class="flex-1 h-0.5 bg-gray-400 relative">
                                    <div class="absolute right-0 top-0 w-0 h-0 border-l-4 border-l-gray-400 border-t-2 border-b-2 border-t-transparent border-b-transparent transform -translate-y-1"></div>
                                </div>
                                
                                <!-- MCP Servers -->
                                <div class="text-center">
                                    <div class="space-y-2">
                                        <div class="w-20 h-12 bg-blue-100 border-2 border-blue-300 rounded-lg flex items-center justify-center">
                                            <span class="text-blue-800 font-bold text-xs">DB Server</span>
                                        </div>
                                        <div class="w-20 h-12 bg-green-100 border-2 border-green-300 rounded-lg flex items-center justify-center">
                                            <span class="text-green-800 font-bold text-xs">Calendar<br>Server</span>
                                        </div>
                                    </div>
                                    <div class="text-xs text-gray-600 mt-2">MCP Servers</div>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>MCP Flow:</strong> LangGraph agent communicates with MCP client, which manages multiple MCP servers for database and calendar operations.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">MCP Server Configuration</h4>
                            <div class="font-mono text-sm bg-gray-100 p-3 rounded">
                                <pre>{
  "mcpServers": {
    "db": {
      "command": "python",
      "args": ["./mcps/local_servers/db_todo.py"],
      "transport": "stdio"
    }
  }
}</pre>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Available Tools</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>‚Ä¢ create_todo - Create new todo items</li>
                                <li>‚Ä¢ get_todos - Retrieve all todos</li>
                                <li>‚Ä¢ complete_todo - Mark todos as completed</li>
                                <li>‚Ä¢ update_todo - Modify todo properties</li>
                                <li>‚Ä¢ delete_todo - Remove todo items</li>
                                <li>‚Ä¢ create_reminder - Add new reminders</li>
                                <li>‚Ä¢ get_reminders - List all reminders</li>
                                <li>‚Ä¢ delete_reminder - Remove reminders</li>
                                <li>‚Ä¢ create_calendar_event - Schedule events</li>
                                <li>‚Ä¢ get_calendar_events - List calendar events</li>
                                <li>‚Ä¢ delete_calendar_event - Remove events</li>
                                <li>‚Ä¢ query_db - Execute custom SQL queries</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Layer -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Data Layer (MCP Server)</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Todo Model</h4>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>‚Ä¢ id: UUID primary key</li>
                            <li>‚Ä¢ title: Task title</li>
                            <li>‚Ä¢ description: Optional details</li>
                            <li>‚Ä¢ completed: Boolean status</li>
                            <li>‚Ä¢ priority: low/medium/high/urgent</li>
                            <li>‚Ä¢ due_date: Optional deadline</li>
                            <li>‚Ä¢ google_calendar_event_id</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Reminder Model</h4>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>‚Ä¢ id: UUID primary key</li>
                            <li>‚Ä¢ reminder_text: Reminder content</li>
                            <li>‚Ä¢ importance: low/medium/high/urgent</li>
                            <li>‚Ä¢ reminder_date: Optional date/time</li>
                            <li>‚Ä¢ google_calendar_event_id</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">CalendarEvent Model</h4>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>‚Ä¢ id: UUID primary key</li>
                            <li>‚Ä¢ title: Event title</li>
                            <li>‚Ä¢ description: Event details</li>
                            <li>‚Ä¢ event_from: Start datetime</li>
                            <li>‚Ä¢ event_to: End datetime</li>
                            <li>‚Ä¢ google_calendar_event_id</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Enhanced LangGraph Tool Calls -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Enhanced LangGraph Tool Calls</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        The LangGraph implementation provides intelligent tool calling capabilities with dynamic tool selection 
                        and error handling. The agent automatically chooses appropriate tools based on user intent and maintains 
                        conversation context for seamless interactions.
                    </p>
                    
                    <!-- Tool Calls Flow Diagram -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Tool Calls Flow Diagram</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="flex justify-center">
                                <img src="/lgch_todo/static/assets/img/tool_calls_flow_diagram.png" 
                                     alt="Tool Calls Flow Diagram" 
                                     class="max-w-full h-auto rounded-lg shadow-lg"
                                     style="max-width: 900px; height: auto;">
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Tool Calls Flow:</strong> LangGraph implementation showing dynamic tool selection and intelligent orchestration of MCP tools.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tool Calls Features -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Tool Calls Features</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-gray-50 p-4 rounded border">
                                    <h5 class="font-semibold text-gray-800 mb-2">MCP Integration</h5>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>‚Ä¢ Database operations via MCP servers</li>
                                        <li>‚Ä¢ Google Calendar synchronization</li>
                                        <li>‚Ä¢ Real-time tool discovery</li>
                                        <li>‚Ä¢ Secure tool communication</li>
                                    </ul>
                                </div>
                                <div class="bg-gray-50 p-4 rounded border">
                                    <h5 class="font-semibold text-gray-800 mb-2">Error Handling</h5>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>‚Ä¢ Graceful tool failure recovery</li>
                                        <li>‚Ä¢ Timeout management</li>
                                        <li>‚Ä¢ Fallback strategies</li>
                                        <li>‚Ä¢ User-friendly error messages</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Tool Features:</strong> Intelligent tool calling system with error recovery and seamless MCP integration.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded border">
                        <h4 class="font-semibold text-gray-800 mb-2">Core Tool Calling Capabilities</h4>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>‚Ä¢ <strong>Dynamic Tool Selection:</strong> LLM intelligently chooses appropriate tools based on user intent</li>
                            <li>‚Ä¢ <strong>Error Recovery:</strong> Graceful handling of tool failures with fallback strategies</li>
                            <li>‚Ä¢ <strong>Context Awareness:</strong> Tools access conversation history and maintain state</li>
                            <li>‚Ä¢ <strong>Streaming Responses:</strong> Real-time tool execution updates for better user experience</li>
                        </ul>
                    </div>
                    
                </div>
            </div>

            <!-- API Endpoints -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">API Endpoints</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Web Interface</h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li><code class="bg-gray-100 px-2 py-1 rounded">GET /</code> - Main portfolio page</li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded">GET /lgch_todo/</code> - LGCH Todo web interface</li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded">GET /lgch-tech-spec</code> - Technical specification</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Agent API</h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li><code class="bg-gray-100 px-2 py-1 rounded">POST /lgch_todo/run_agent</code> - Run Luna agent</li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded">WS localhost:5001</code> - WebSocket server (separate process)</li>
                        </ul>
                        <div class="mt-3 p-3 bg-gray-50 rounded">
                            <p class="text-xs text-gray-600 mb-2">Request Format:</p>
                            <pre class="text-xs"><code>{
  "prompt": "Create a high priority todo"
}</code></pre>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Twilio Integration</h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li><code class="bg-gray-100 px-2 py-1 rounded">POST /lgch_todo/twilio/call</code> - Handle incoming calls</li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded">POST /lgch_todo/twilio/process_audio</code> - Process speech input</li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded">WS localhost:5001</code> - Real-time audio streaming</li>
                        </ul>
                        <div class="mt-3 p-3 bg-gray-50 rounded">
                            <p class="text-xs text-gray-600 mb-2">TwiML Response:</p>
                            <pre class="text-xs"><code>&lt;Response&gt;
  &lt;Say voice="Polly.Amy"&gt;Hello! I'm Luna...&lt;/Say&gt;
  &lt;Gather input="speech" 
        action="/lgch_todo/twilio/process_audio"&gt;
  &lt;/Gather&gt;
&lt;/Response&gt;</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Voice Interface -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Voice Interface</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        Luna provides a complete voice interface using OpenAI's Whisper for speech-to-text and TTS for text-to-speech responses.
                        The system supports both local voice interaction and phone-based voice calls through Twilio integration.
                    </p>
                    
                    <!-- Voice Processing Pipeline -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Voice Processing Pipeline</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <!-- Pipeline Flow -->
                            <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                                <!-- Audio Input -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-blue-100 border-2 border-blue-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-blue-800 font-bold text-sm">üé§</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Audio Input</div>
                                    <div class="text-xs text-gray-600">Œº-law/PCM</div>
                                </div>
                                
                                <!-- Audio Buffer -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-yellow-100 border-2 border-yellow-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-yellow-800 font-bold text-sm">üì¶</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Audio Buffer</div>
                                    <div class="text-xs text-gray-600">Base64 Decode</div>
                                </div>
                                
                                <!-- Whisper STT -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-green-100 border-2 border-green-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-green-800 font-bold text-sm">üëÇ</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Whisper STT</div>
                                    <div class="text-xs text-gray-600">Speech ‚Üí Text</div>
                                </div>
                                
                                <!-- LangGraph Agent -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-purple-100 border-2 border-purple-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-purple-800 font-bold text-sm">üß†</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">LangGraph Agent</div>
                                    <div class="text-xs text-gray-600">AI Processing</div>
                                </div>
                                
                                <!-- OpenAI TTS -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-orange-100 border-2 border-orange-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-orange-800 font-bold text-sm">üó£Ô∏è</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">OpenAI TTS</div>
                                    <div class="text-xs text-gray-600">Text ‚Üí Speech</div>
                                </div>
                                
                                <!-- Audio Output -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-red-100 border-2 border-red-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-red-800 font-bold text-sm">üîä</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Audio Output</div>
                                    <div class="text-xs text-gray-600">PCM Stream</div>
                                </div>
                            </div>
                            
                            <!-- Flow Arrows -->
                            <div class="mt-6">
                                <div class="flex justify-between items-center">
                                    <div class="text-xs text-gray-600">Real-time Audio</div>
                                    <div class="flex-1 h-0.5 bg-blue-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Processing</div>
                                    <div class="flex-1 h-0.5 bg-green-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">AI Response</div>
                                    <div class="flex-1 h-0.5 bg-orange-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Voice Output</div>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Voice Pipeline:</strong> Complete end-to-end voice processing from audio input to AI-generated speech output with real-time streaming capabilities.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Voice Components</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>‚Ä¢ <strong>Speech-to-Text:</strong> OpenAI Whisper API</li>
                                <li>‚Ä¢ <strong>Text-to-Speech:</strong> OpenAI TTS API (gpt-4o-mini-tts)</li>
                                <li>‚Ä¢ <strong>Audio Processing:</strong> sounddevice & scipy libraries</li>
                                <li>‚Ä¢ <strong>Audio Format:</strong> Œº-law to PCM conversion</li>
                                <li>‚Ä¢ <strong>Voice Model:</strong> fable voice with cheerful tone</li>
                                <li>‚Ä¢ <strong>Streaming:</strong> Real-time audio chunk processing</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Processing Flow</h4>
                            <ol class="text-sm text-gray-600 space-y-1">
                                <li>1. Audio received via WebSocket</li>
                                <li>2. Base64 decoded to audio buffer</li>
                                <li>3. Œº-law converted to PCM for Whisper</li>
                                <li>4. Speech transcribed via Whisper API</li>
                                <li>5. Text processed by LangGraph agent</li>
                                <li>6. Response generated with MCP tools</li>
                                <li>7. Text converted to speech via TTS</li>
                                <li>8. Audio streamed back via WebSocket</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Twilio Integration -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Twilio Phone Integration</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        Luna can be accessed via phone calls through Twilio integration, allowing users to interact with the AI assistant 
                        through voice calls from any phone number. The system uses a sophisticated WebSocket-based architecture for real-time voice processing.
                    </p>
                    
                    <!-- Twilio Call Flow Architecture -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Twilio Call Flow Architecture</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <!-- Main Flow -->
                            <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                                <!-- Phone Call -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-blue-100 border-2 border-blue-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-blue-800 font-bold text-sm">üìû</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Phone Call</div>
                                    <div class="text-xs text-gray-600">PSTN Network</div>
                                </div>
                                
                                <!-- Twilio -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-red-100 border-2 border-red-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-red-800 font-bold text-sm">T</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Twilio</div>
                                    <div class="text-xs text-gray-600">Voice API</div>
                                </div>
                                
                                <!-- Flask Webhook -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-green-100 border-2 border-green-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-green-800 font-bold text-sm">üåê</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Flask Webhook</div>
                                    <div class="text-xs text-gray-600">TwiML Response</div>
                                </div>
                                
                                <!-- WebSocket Server -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-purple-100 border-2 border-purple-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-purple-800 font-bold text-sm">üîå</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">WebSocket Server</div>
                                    <div class="text-xs text-gray-600">Port 5001</div>
                                </div>
                                
                                <!-- Twilio Handler -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-orange-100 border-2 border-orange-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-orange-800 font-bold text-sm">‚öôÔ∏è</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Twilio Handler</div>
                                    <div class="text-xs text-gray-600">AI Integration</div>
                                </div>
                                
                                <!-- LangGraph Agent -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-indigo-100 border-2 border-indigo-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-indigo-800 font-bold text-sm">üß†</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">LangGraph Agent</div>
                                    <div class="text-xs text-gray-600">AI Processing</div>
                                </div>
                            </div>
                            
                            <!-- Flow Arrows -->
                            <div class="mt-6">
                                <div class="flex justify-between items-center">
                                    <div class="text-xs text-gray-600">Call Initiation</div>
                                    <div class="flex-1 h-0.5 bg-blue-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Webhook</div>
                                    <div class="flex-1 h-0.5 bg-green-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">WebSocket</div>
                                    <div class="flex-1 h-0.5 bg-purple-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">AI Processing</div>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Call Flow:</strong> Twilio Call ‚Üí WebSocket ‚Üí http_websocket_server.py ‚Üí twilio_handler.py ‚Üí voice_utils.py ‚Üí assistant_graph_todo.py
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Twilio Components</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>‚Ä¢ <strong>Twilio Voice API:</strong> Handles incoming/outgoing calls</li>
                                <li>‚Ä¢ <strong>Media Streams:</strong> Real-time audio streaming</li>
                                <li>‚Ä¢ <strong>Webhook Endpoints:</strong> Flask routes for call handling</li>
                                <li>‚Ä¢ <strong>TwiML Responses:</strong> Call flow instructions</li>
                                <li>‚Ä¢ <strong>WebSocket Bridge:</strong> Bidirectional audio streaming</li>
                                <li>‚Ä¢ <strong>ngrok Tunneling:</strong> Secure public access</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Call Flow Process</h4>
                            <ol class="text-sm text-gray-600 space-y-1">
                                <li>1. User calls Twilio phone number</li>
                                <li>2. Twilio webhook triggers Flask endpoint</li>
                                <li>3. TwiML response starts Media Stream</li>
                                <li>4. WebSocket connection to port 5001</li>
                                <li>5. Audio streamed to twilio_handler.py</li>
                                <li>6. Speech processed via voice_utils.py</li>
                                <li>7. LangGraph agent generates response</li>
                                <li>8. Audio streamed back to caller</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-white p-4 rounded border">
                        <h4 class="font-semibold text-gray-800 mb-2">Twilio Configuration</h4>
                        <div class="font-mono text-sm bg-gray-100 p-3 rounded">
                            <pre># Environment Variables
TWILIO_ACCOUNT_SID=your_account_sid
TWILIO_AUTH_TOKEN=your_auth_token
TWILIO_PHONE_NUMBER=+1234567890
WEBHOOK_BASE_URL=https://your-ngrok-url.ngrok.io

# Webhook Endpoints
POST /lgch_todo/twilio/call - Handle incoming calls
POST /lgch_todo/twilio/process_audio - Process speech input
WS localhost:5001 - WebSocket server (separate process)

# TwiML Response
&lt;Response&gt;
  &lt;Gather action="/lgch_todo/twilio/process_audio" method="POST" input="speech" speechTimeout="auto" timeout="10" barge_in="true"&gt;
    &lt;Say voice="Polly.Amy"&gt;Hello! I'm Luna...&lt;/Say&gt;
  &lt;/Gather&gt;
  &lt;Say voice="Polly.Amy"&gt;I didn't hear anything. Please try again.&lt;/Say&gt;
  &lt;Redirect&gt;/lgch_todo/twilio/call?is_continuation=true&lt;/Redirect&gt;
&lt;/Response&gt;</pre>
                        </div>
                    </div>
                </div>
            </div>


            <!-- ngrok Configuration -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">ngrok Tunnel Configuration</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        ngrok provides secure tunneling to expose local development servers to the internet, 
                        enabling Twilio webhooks and external API access. The system includes automated ngrok management 
                        for seamless development and deployment.
                    </p>
                    
                    <!-- ngrok Tunnel Architecture -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">ngrok Tunnel Architecture</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <!-- Local Development -->
                                <div class="text-center">
                                    <h5 class="text-sm font-bold text-gray-800 mb-3">Local Development</h5>
                                    <div class="space-y-2">
                                        <div class="bg-blue-100 border border-blue-300 rounded p-3">
                                            <div class="text-xs font-medium text-blue-800">Flask App</div>
                                            <div class="text-xs text-blue-600">localhost:5000</div>
                                        </div>
                                        <div class="bg-green-100 border border-green-300 rounded p-3">
                                            <div class="text-xs font-medium text-green-800">WebSocket</div>
                                            <div class="text-xs text-green-600">localhost:5001</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ngrok Tunnels -->
                                <div class="text-center">
                                    <h5 class="text-sm font-bold text-gray-800 mb-3">ngrok Tunnels</h5>
                                    <div class="space-y-2">
                                        <div class="bg-cyan-100 border border-cyan-300 rounded p-3">
                                            <div class="text-xs font-medium text-cyan-800">Flask Tunnel</div>
                                            <div class="text-xs text-cyan-600">https://app.ngrok.io</div>
                                        </div>
                                        <div class="bg-purple-100 border border-purple-300 rounded p-3">
                                            <div class="text-xs font-medium text-purple-800">WebSocket Tunnel</div>
                                            <div class="text-xs text-purple-600">https://ws.ngrok.io</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- External Access -->
                                <div class="text-center">
                                    <h5 class="text-sm font-bold text-gray-800 mb-3">External Access</h5>
                                    <div class="space-y-2">
                                        <div class="bg-red-100 border border-red-300 rounded p-3">
                                            <div class="text-xs font-medium text-red-800">Twilio Webhooks</div>
                                            <div class="text-xs text-red-600">Secure HTTPS</div>
                                        </div>
                                        <div class="bg-yellow-100 border border-yellow-300 rounded p-3">
                                            <div class="text-xs font-medium text-yellow-800">API Access</div>
                                            <div class="text-xs text-yellow-600">Public Endpoints</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tunnel Flow -->
                            <div class="mt-6 flex justify-center items-center space-x-4">
                                <div class="text-xs text-gray-600">Local Services</div>
                                <div class="flex-1 h-0.5 bg-gray-400 relative">
                                    <div class="absolute right-0 top-0 w-0 h-0 border-l-4 border-l-gray-400 border-t-2 border-b-2 border-t-transparent border-b-transparent transform -translate-y-1"></div>
                                </div>
                                <div class="text-xs text-gray-600">ngrok Tunnels</div>
                                <div class="flex-1 h-0.5 bg-gray-400 relative">
                                    <div class="absolute right-0 top-0 w-0 h-0 border-l-4 border-l-gray-400 border-t-2 border-b-2 border-t-transparent border-b-transparent transform -translate-y-1"></div>
                                </div>
                                <div class="text-xs text-gray-600">Internet</div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Tunnel Flow:</strong> ngrok creates secure tunnels from local development servers to public URLs, enabling external service integration.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">ngrok Features</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>‚Ä¢ <strong>Automatic Tunnel Management:</strong> Start/stop tunnels programmatically</li>
                                <li>‚Ä¢ <strong>HTTP Tunnel Support:</strong> Flask (5000) and WebSocket (5001) via HTTP</li>
                                <li>‚Ä¢ <strong>HTTPS/WSS Support:</strong> Automatic SSL/TLS for secure connections</li>
                                <li>‚Ä¢ <strong>Real-time Monitoring:</strong> Tunnel status via ngrok API (port 4040)</li>
                                <li>‚Ä¢ <strong>Configuration Management:</strong> YAML-based setup with ngrok.yml</li>
                                <li>‚Ä¢ <strong>Process Management:</strong> Automated tunnel lifecycle management</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Tunnel Setup</h4>
                            <div class="font-mono text-sm bg-gray-100 p-3 rounded">
                                <pre># ngrok.yml configuration
version: "2"
authtoken: your_ngrok_token
tunnels:
  flask:
    proto: http
    addr: 5000
    schemes: [https]
  websocket:
    proto: http
    addr: 5001
    schemes: [https]</pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-white p-4 rounded border">
                        <h4 class="font-semibold text-gray-800 mb-2">Automated Tunnel Management</h4>
                        <div class="font-mono text-sm bg-gray-100 p-3 rounded">
                            <pre># Python script for tunnel management (setup_ngrok_tunnels.py)
import subprocess
import requests
import time
import sys
import os

def get_ngrok_tunnels():
    """Get active ngrok tunnels from API."""
    try:
        response = requests.get("http://localhost:4040/api/tunnels", timeout=5)
        return response.json()
    except Exception as e:
        print(f"‚ö†Ô∏è  Could not connect to ngrok API: {e}")
        return None

def create_ngrok_tunnel(port, name, protocol="http"):
    """Create an ngrok tunnel for a specific port."""
    print(f"üîó Creating ngrok tunnel for {name} on port {port}...")
    
    # Kill any existing tunnels on this port
    subprocess.run(["pkill", "-f", f"ngrok.*{port}"], check=False)
    time.sleep(2)
    
    # Start ngrok tunnel
    cmd = ["ngrok", "http", str(port), "--log=stdout"]
    process = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    
    # Wait for tunnel to be ready
    print(f"‚è≥ Waiting for {name} tunnel to initialize...")
    time.sleep(5)
    
    # Get tunnel info with retries
    for attempt in range(3):
        tunnels = get_ngrok_tunnels()
        if tunnels and 'tunnels' in tunnels:
            for tunnel in tunnels['tunnels']:
                addr = tunnel['config']['addr']
                if (addr == f'localhost:{port}' or 
                    addr == f'127.0.0.1:{port}'):
                    public_url = tunnel['public_url']
                    print(f"‚úÖ {name} tunnel created: {public_url}")
                    return public_url, process
        
        if attempt < 2:
            print(f"‚è≥ Retrying tunnel detection for {name}...")
            time.sleep(2)
    
    print(f"‚ùå Failed to create {name} tunnel")
    process.terminate()
    return None, None

def main():
    print("üöÄ Setting up ngrok tunnels for Twilio integration...")
    
    # Create tunnels
    flask_url, flask_process = create_ngrok_tunnel(5000, "Flask Server", "http")
    websocket_url, websocket_process = create_ngrok_tunnel(5001, "WebSocket Server", "http")
    
    if flask_url:
        print(f"üìû Flask Server: {flask_url}")
        if websocket_url:
            print(f"üîå WebSocket Server: {websocket_url}")
        print(f"üì± Twilio Webhook URL: {flask_url}/lgch_todo/twilio/call")
        
        try:
            # Keep running
            while True:
                time.sleep(1)
        except KeyboardInterrupt:
            print("üõë Stopping ngrok tunnels...")
            if flask_process:
                flask_process.terminate()
            if websocket_process:
                websocket_process.terminate()
            print("‚úÖ Tunnels stopped.")

if __name__ == "__main__":
    main()</pre>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Code Examples -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Code Examples</h3>
                <div class="space-y-6">
                    
                    <!-- LangGraph Agent Example -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">LangGraph Agent (assistant_graph_todo.py)</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>from langchain_core.tools import BaseTool
from langchain_openai import ChatOpenAI
from langgraph.graph import StateGraph
from langgraph.prebuilt import ToolNode, tools_condition

class TodoAgent:
    def __init__(self, tools: List[BaseTool] = []):
        self.tools = tools
        self.llm = ChatOpenAI(model="gpt-4.1-mini-2025-04-14").bind_tools(tools=self.tools)
        self.graph = self.build_graph()

    def build_graph(self) -> CompiledStateGraph:
        builder = StateGraph(AgentState)
        
        def assistant(state: AgentState):
            response = self.llm.invoke(state.messages)
            state.messages.append(response)
            return state

        builder.add_node("assistant", assistant)
        builder.add_node("tools", ToolNode(self.tools))
        
        builder.set_entry_point("assistant")
        builder.add_conditional_edges("assistant", tools_condition)
        builder.add_edge("tools", "assistant")
        
        return builder.compile(checkpointer=InMemorySaver())</code></pre>
                    </div>

                    <!-- Flask Routes Example -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Flask API Routes (routes.py)</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>from flask import Blueprint, request, jsonify, render_template, Response
from langchain_core.messages import HumanMessage
from langgraph.graph import StateGraph
import asyncio
import json
import os
import requests
from langchain_mcp_adapters.client import MultiServerMCPClient
from .assistant_graph_todo import TodoAgent
from .state import AgentState

lgch_todo_bp = Blueprint('lgch_todo', __name__, url_prefix='/lgch_todo')

@lgch_todo_bp.route('/')
def index():
    """Web interface endpoint."""
    template_path = os.path.join(os.path.dirname(__file__), 'templates', 'lgch_todo_index.html')
    if os.path.exists(template_path):
        return render_template('lgch_todo_index.html')
    return "LGCH Todo: LangGraph + MCP integration is ready. POST to /lgch_todo/run_agent with JSON {prompt: str}."

async def _get_agent_graph() -> StateGraph:
    """Helper to initialize the agent graph with tools."""
    config_path = os.path.join(os.path.dirname(__file__), 'mcps', 'mcp_config.json')
    if not os.path.exists(config_path):
        # Fallback path for when running from the root directory
        config_path = os.path.join('lgch_todo', 'mcps', 'mcp_config.json')

    with open(config_path) as f:
        mcp_config = json.load(f)
    
    # Set working directory to project root for MCP servers
    project_root = os.path.dirname(os.path.dirname(__file__))
    original_cwd = os.getcwd()
    os.chdir(project_root)
    
    # Update the MCP config with absolute paths
    for server_name, server_config in mcp_config["mcpServers"].items():
        if "args" in server_config and len(server_config["args"]) > 0:
            relative_path = server_config["args"][0]
            if not os.path.isabs(relative_path):
                absolute_path = os.path.join(project_root, relative_path)
                server_config["args"][0] = absolute_path
    
    try:
    client = MultiServerMCPClient(connections=mcp_config["mcpServers"])
    tools = await client.get_tools()
        return TodoAgent(tools=tools).build_graph()
    finally:
        os.chdir(original_cwd)

async def _run_agent_async(prompt: str) -> str:
    """Runs the agent for a given prompt and returns the final response."""
    agent_graph = await _get_agent_graph()

    input_state = AgentState(
        messages=[HumanMessage(content=prompt)],
        customer_id=""
    )
    config = {"configurable": {"thread_id": "flask-thread-1"}}

    # Stream through the graph to execute the agent logic
    async for _ in agent_graph.astream(input=input_state, stream_mode="values", config=config):
        pass

    final_state = agent_graph.get_state(config=config)
    last_message = final_state.values.get("messages")[-1]
    return getattr(last_message, 'content', "")

@lgch_todo_bp.route('/run_agent', methods=['POST'])
def run_agent():
    """API endpoint for running the agent with a text prompt."""
    data = request.get_json(silent=True) or {}
    prompt = data.get('prompt')
    if not prompt:
        return jsonify({"error": "Missing 'prompt' in JSON body"}), 400

    try:
        result = asyncio.run(_run_agent_async(prompt))
        return jsonify({"result": result})
    except Exception as e:
        # Log the full error for debugging
        print(f"Error in /run_agent: {e}")
        return jsonify({"error": str(e)}), 500</code></pre>
                    </div>

                    <!-- MCP Server Example -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">MCP Server Tools (db_todo.py)</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>from mcp.server.fastmcp import FastMCP
from sqlalchemy.orm import Session
from .models import DBTodo, DBReminder, DBCalendarEvent

mcp = FastMCP("db_todo")

@mcp.tool()
async def create_todo(
    title: str,
    description: Optional[str] = None,
    priority: TodoPriority = TodoPriority.MEDIUM,
    due_date: Optional[datetime] = None,
) -> str:
    """Create a new todo item with title, description, priority, and optional due date."""
    with SessionLocal() as session:
        new_todo = DBTodo(
            title=title,
            description=description,
            priority=priority.value,
            due_date=due_date,
        )
        session.add(new_todo)
        session.commit()
        session.refresh(new_todo)
        
        # Sync with Google Calendar
        try:
            calendar_service = get_calendar_service()
            google_event_id = calendar_service.create_event(
                title=f"TODO: {title}",
                description=description or "Task from LGCH Todo System"
            )
            if google_event_id:
                new_todo.google_calendar_event_id = google_event_id
                session.commit()
        except Exception as e:
            print(f"Failed to sync with Google Calendar: {e}")
    
    return Todo.model_validate(new_todo.__dict__).model_dump_json(indent=2)</code></pre>
                    </div>

                    <!-- Voice Utils Example -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Voice Interface (voice_utils.py)</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>import sounddevice as sd
import scipy.io.wavfile as wav
from openai import AsyncOpenAI

async def record_audio_until_stop() -> str:
    """Record audio from microphone until Enter is pressed."""
    print("Recording... Press Enter to stop.")
    
    # Record audio
    sample_rate = 44100
    audio_data = sd.rec(int(sample_rate * 60), samplerate=sample_rate, channels=1)
    input("Press Enter to stop recording...")
    sd.stop()
    
    # Save and transcribe
    wav.write("temp_audio.wav", sample_rate, audio_data)
    
    with open("temp_audio.wav", "rb") as audio_file:
        transcript = await openai_async.audio.transcriptions.create(
            model="whisper-1",
            file=audio_file
        )
    
    return transcript.text

async def play_audio(message: str):
    """Convert text to speech and play audio."""
    response = await openai_async.audio.speech.create(
        model="gpt-4o-mini-tts",
        voice="fable",
        input=message,
        instructions="Speak in a cheerful, helpful tone with a brisk pace.",
        response_format="pcm",
        speed=1.2,
    )
    
    # Play audio using sounddevice
    audio_data = np.frombuffer(response.content, dtype=np.int16)
    sd.play(audio_data, samplerate=24000)
    sd.wait()</code></pre>
                    </div>

                    <!-- Twilio Integration Example -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Twilio Webhook Handler (routes.py)</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>from flask import Blueprint, request, Response
from twilio.twiml.voice_response import VoiceResponse, Gather
import asyncio
import json
import os
import requests

lgch_todo_bp = Blueprint('lgch_todo', __name__, url_prefix='/lgch_todo')

def get_webhook_base_url():
    """Get the webhook base URL for Twilio webhooks."""
    if os.getenv('FLASK_ENV') == 'production':
        return os.getenv('WEBHOOK_BASE_URL', 'https://hjlees.com')
    else:
        # Development: Try ngrok first, fallback to localhost
        try:
            response = requests.get("http://localhost:4040/api/tunnels", timeout=5)
            tunnels = response.json()
            for tunnel in tunnels.get('tunnels', []):
                if tunnel.get('config', {}).get('addr') == 'http://localhost:5000':
                    return tunnel.get('public_url', 'http://localhost:5000')
            return "http://localhost:5000"
        except Exception:
            return "http://localhost:5000"

@lgch_todo_bp.route('/twilio/call', methods=['POST'])
def twilio_call_webhook():
    """Handles incoming calls from Twilio with barge-in capability."""
    is_continuation = request.args.get('is_continuation', 'false').lower() == 'true'
    response = VoiceResponse()
    
    # Use Gather to collect speech input with barge-in capability
    gather = response.gather(
        input='speech',
        action='/lgch_todo/twilio/process_audio',
        method='POST',
        speech_timeout='auto',
        timeout=10,
        barge_in=True  # Enable barge-in to interrupt while speaking
    )
    
    # Only say the welcome message if this is the initial call
    if not is_continuation:
        gather.say("Hello! I'm Luna, your personal productivity assistant. How can I help you today?", voice='Polly.Amy')
    
    # Fallback if no speech is detected
    response.say("I didn't hear anything. Please try again.", voice='Polly.Amy')
    response.redirect('/lgch_todo/twilio/call?is_continuation=true')
    
    return Response(str(response), mimetype='text/xml')

@lgch_todo_bp.route('/twilio/process_audio', methods=['POST'])
def process_audio_webhook():
    """Handles audio processing requests from Twilio."""
    try:
        transcribed_text = request.form.get('SpeechResult', '')
        call_sid = request.form.get('CallSid', '')
        
        if not transcribed_text or len(transcribed_text.strip()) < 2:
            response = VoiceResponse()
            gather = Gather(
                input='speech',
                action='/lgch_todo/twilio/process_audio',
                method='POST',
                speech_timeout='auto',
                timeout=10,
                barge_in=True
            )
            gather.say("I didn't catch that. Could you please repeat?", voice='Polly.Amy')
            response.append(gather)
            response.say("I didn't hear anything. Please try again.", voice='Polly.Amy')
            response.redirect('/lgch_todo/twilio/call?is_continuation=true')
            return Response(str(response), mimetype='text/xml')
        
        # Check if user wants to end the call
        exit_phrases = ['exit', 'goodbye', 'bye', 'that\'s it', 'thank you', 'done']
        if any(phrase in transcribed_text.lower() for phrase in exit_phrases):
            response = VoiceResponse()
            response.say("Thank you for using Luna! Have a great day!", voice='Polly.Amy')
            response.hangup()
            return Response(str(response), mimetype='text/xml')
        
        # Process with the agent
        agent_response = asyncio.run(_run_agent_async(transcribed_text))
        
        # Return TwiML with the agent's response and barge-in capability
        response = VoiceResponse()
        gather = Gather(
            input='speech',
            action='/lgch_todo/twilio/process_audio',
            method='POST',
            speech_timeout='auto',
            timeout=10,
            barge_in=True  # Enable barge-in to interrupt while speaking
        )
        gather.say(agent_response, voice='Polly.Amy')
        response.append(gather)
        response.say("I didn't hear anything. Please try again.", voice='Polly.Amy')
        response.redirect('/lgch_todo/twilio/call?is_continuation=true')
        
        return Response(str(response), mimetype='text/xml')
        
            except Exception as e:
        response = VoiceResponse()
        gather = Gather(
            input='speech',
            action='/lgch_todo/twilio/process_audio',
            method='POST',
            speech_timeout='auto',
            timeout=10,
            barge_in=True
        )
        gather.say("I'm sorry, I encountered an error. Please try again.", voice='Polly.Amy')
        response.append(gather)
        response.say("I didn't hear anything. Please try again.", voice='Polly.Amy')
        response.redirect('/lgch_todo/twilio/call?is_continuation=true')
        return Response(str(response), mimetype='text/xml')</code></pre>
                    </div>



                </div>
            </div>
        </div>
    </section>

    <!-- Usage Guide -->
    <section class="py-16 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-center mb-12">Usage Guide</h2>
            

            <!-- Setup and Deployment -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Setup and Deployment</h3>
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">1. Environment Setup</h4>
                            <div class="bg-gray-50 p-4 rounded">
                                <pre class="text-sm"><code># Install dependencies
pip install -r requirements.txt

# Set up environment variables
export OPENAI_API_KEY="your_openai_key"
export TWILIO_ACCOUNT_SID="your_twilio_sid"
export TWILIO_AUTH_TOKEN="your_twilio_token"
export TWILIO_PHONE_NUMBER="+1234567890"
export GOOGLE_CREDENTIALS_FILE="path/to/credentials.json"
export DB_URI="postgresql://user:pass@localhost/lgch_todo"</code></pre>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">2. ngrok Configuration</h4>
                            <div class="bg-gray-50 p-4 rounded">
                                <pre class="text-sm"><code># Install ngrok
brew install ngrok  # macOS
# or download from https://ngrok.com/

# Configure ngrok
ngrok config add-authtoken your_ngrok_token

# Start tunnels
python setup_ngrok_tunnels.py</code></pre>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">3. Twilio Setup</h4>
                            <div class="space-y-4">
                            <div class="bg-gray-50 p-4 rounded">
                                    <h5 class="font-semibold text-gray-700 mb-2">Step 1: Configure Voice Settings</h5>
                                    <p class="text-sm text-gray-600 mb-3">In your Twilio Console, navigate to Phone Numbers ‚Üí Manage ‚Üí Active numbers and select your phone number.</p>
                                    <div class="flex justify-center mb-3">
                                        <img src="/lgch_todo/static/assets/img/voice_cfg.png" 
                                             alt="Twilio Voice Configuration" 
                                             class="max-w-full h-auto rounded-lg shadow-md border"
                                             style="max-width: 600px;">
                                    </div>
                                    <p class="text-sm text-gray-600">Configure the voice settings as shown above, ensuring the webhook URL points to your ngrok tunnel.</p>
                                </div>
                                
                                <div class="bg-gray-50 p-4 rounded">
                                    <h5 class="font-semibold text-gray-700 mb-2">Step 2: Set Webhook URL</h5>
                                    <p class="text-sm text-gray-600 mb-3">Update your Twilio phone number webhook to point to your ngrok tunnel:</p>
                                    <div class="flex justify-center mb-3">
                                        <img src="/lgch_todo/static/assets/img/webhook_url.png" 
                                             alt="Twilio Webhook URL Configuration" 
                                             class="max-w-full h-auto rounded-lg shadow-md border"
                                             style="max-width: 600px;">
                                    </div>
                                    <pre class="text-sm bg-white p-3 rounded border"><code># Webhook URL format:
https://your-ngrok-url.ngrok.io/lgch_todo/twilio/call

# Example like screenshot:
https://8badb2f186a0.ngrok-free.app/lgch_todo/twilio/call</code></pre>
                                </div>
                                
                                <div class="bg-gray-50 p-4 rounded">
                                    <h5 class="font-semibold text-gray-700 mb-2">Step 3: Test Integration</h5>
                                    <pre class="text-sm"><code># Test the webhook endpoint
curl -X POST https://your-ngrok-url.ngrok.io/lgch_todo/twilio/call \
  -d "CallSid=test123&From=+1234567890"

# Expected response: TwiML with Luna's greeting</code></pre>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">4. Start Production Services</h4>
                            <div class="bg-gray-50 p-4 rounded">
                                <pre class="text-sm"><code># Terminal 1: Start application servers
python start_servers.py

# Terminal 2: Start ngrok tunnels for Twilio integration
python setup_ngrok_tunnels.py

# Verify services are running:
# - Flask Server: http://localhost:5000
# - WebSocket Server: ws://localhost:5001
# - ngrok Tunnels: Check ngrok dashboard at http://localhost:4040</code></pre>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">5. Production Verification</h4>
                            <div class="bg-gray-50 p-4 rounded">
                                <pre class="text-sm"><code># Test Twilio webhook endpoint
curl -X POST https://your-ngrok-url.ngrok.io/lgch_todo/twilio/call \
  -d "CallSid=test123&From=+1234567890"

# Check service health
curl http://localhost:5000/lgch_todo/run_agent \
  -H "Content-Type: application/json" \
  -d '{"prompt": "Test connection"}'

# Monitor logs for any errors
tail -f logs/app.log  # if logging is configured</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Production Usage -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Production Usage</h3>
                    <div class="bg-white p-6 rounded-lg shadow">
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Phone Integration via Twilio</h4>
                        <p class="text-gray-700 mb-4">
                            Once deployed, users can call your Twilio phone number to interact with Luna. 
                            The system supports barge-in functionality, allowing users to interrupt the agent while speaking.
                        </p>
                        <div class="bg-blue-50 p-4 rounded border-l-4 border-blue-400">
                            <p class="text-sm text-blue-800">
                                <strong>Note:</strong> Ensure your Twilio webhook URL is properly configured to point to your ngrok tunnel URL.
                            </p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-50 p-4 rounded">
                            <h5 class="font-semibold text-gray-800 mb-2">Todo Management</h5>
                            <ul class="text-sm text-gray-600 space-y-1">
                            <li>‚Ä¢ "Create a high priority todo to buy groceries"</li>
                            <li>‚Ä¢ "Show me all my pending todos"</li>
                            <li>‚Ä¢ "Mark the grocery shopping todo as completed"</li>
                            <li>‚Ä¢ "Update the project todo with a new description"</li>
                            <li>‚Ä¢ "Delete the old todo about cleaning"</li>
                        </ul>
                    </div>
                        <div class="bg-gray-50 p-4 rounded">
                            <h5 class="font-semibold text-gray-800 mb-2">Reminders & Calendar</h5>
                            <ul class="text-sm text-gray-600 space-y-1">
                            <li>‚Ä¢ "Create a reminder to call mom tomorrow at 2 PM"</li>
                            <li>‚Ä¢ "Schedule a meeting for next Friday from 2 to 3 PM"</li>
                            <li>‚Ä¢ "What's on my calendar for this week?"</li>
                            <li>‚Ä¢ "Add a reminder about the dentist appointment"</li>
                            <li>‚Ä¢ "Show me all my upcoming events"</li>
                        </ul>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Test Result and Validation -->
    <section class="py-12 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Test Result and Validation</h3>
                    <div class="bg-white p-6 rounded-lg shadow">
                    <p class="text-gray-700 mb-6">
                        The LGCH Todo system has been thoroughly tested with a focus on the core MCP tools: create_todo, complete_todo, create_reminder, and delete_reminder functionality. 
                        All tests demonstrate successful integration across voice interface, database operations, and Google Calendar synchronization.
                    </p>
                    
                    <!-- Primary Test: Create Todo Tool -->
                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4 text-gray-800">1. Create Todo Tool</h4>
                        <p class="text-gray-600 mb-6">
                            Comprehensive testing of the create_todo MCP tool across all integration points, demonstrating 
                            end-to-end functionality from voice input to database storage and calendar synchronization.
                        </p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Voice Interface Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Voice Interface</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                Voice-to-text transcription and todo creation through the create_todo MCP tool.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/create_todo_twilio.png" 
                                     alt="Voice Interface Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="mb-3">
                                <audio controls class="w-full">
                                    <source src="/lgch_todo/static/assets/img/create_todo.wav" type="audio/wav">
                                    Your browser does not support the audio element.
                                </audio>
                                <p class="text-xs text-gray-500 mt-1">Audio: "Create a high priority todo task to buy groceries at Costco"</p>
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Input:</strong> "Create a high priority todo task to buy groceries at Costco"<br>
                                <strong>Output:</strong> ‚úÖ Todo created via voice
                            </div>
                        </div>
                        
                        <!-- Database Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Database Storage</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                create_todo MCP tool successfully stores todos in PostgreSQL database.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/create_todo_table.png" 
                                     alt="Database Storage Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Process:</strong> MCP tool ‚Üí Database<br>
                                <strong>Result:</strong> ‚úÖ Todo persisted in DB
                            </div>
                        </div>
                        
                        <!-- Calendar Sync Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Calendar Synchronization</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                create_todo tool automatically syncs todos to Google Calendar events.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/create_todo_gc.png" 
                                     alt="Calendar Sync Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Process:</strong> Todo ‚Üí Calendar Event<br>
                                <strong>Result:</strong> ‚úÖ Event created in Google Calendar
                            </div>
                        </div>
                        </div>
                    </div>
                    
                    <!-- Secondary Test: Complete Todo Tool -->
                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4 text-gray-800">2. Complete Todo Tool</h4>
                        <p class="text-gray-600 mb-6">
                            Comprehensive testing of the complete_todo MCP tool functionality, demonstrating 
                            successful todo completion workflow from voice input to database update and calendar synchronization.
                        </p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Voice Interface Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Voice Interface</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                Voice-to-text transcription and todo completion through the complete_todo MCP tool.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/complete_todo_twilio.png" 
                                     alt="Complete Todo Voice Interface Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="mb-3">
                                <audio controls class="w-full">
                                    <source src="/lgch_todo/static/assets/img/complete_todo.wav" type="audio/wav">
                                    Your browser does not support the audio element.
                                </audio>
                                <p class="text-xs text-gray-500 mt-1">Audio: "Buy groceries at Costco needs to completed"</p>
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Input:</strong> "Buy groceries at Costco needs to completed"<br>
                                <strong>Output:</strong> ‚úÖ Todo marked as completed via voice
                            </div>
                        </div>
                        
                        <!-- Database Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Database Update</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                complete_todo MCP tool successfully updates todo status in PostgreSQL database.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/complete_todo_table.png" 
                                     alt="Complete Todo Database Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Process:</strong> MCP tool ‚Üí Database Update<br>
                                <strong>Result:</strong> ‚úÖ Todo status updated to completed
                            </div>
                        </div>
                        
                        <!-- Calendar Sync Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Calendar Synchronization</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                complete_todo tool automatically updates corresponding Google Calendar event.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/complete_gc.png" 
                                     alt="Complete Todo Calendar Sync Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Process:</strong> Todo Completion ‚Üí Calendar Event Update<br>
                                <strong>Result:</strong> ‚úÖ Calendar event marked as completed
                            </div>
                        </div>
                        </div>
                    </div>
                    
                    <!-- Tertiary Test: Create Reminder Tool -->
                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4 text-gray-800">3. Create Reminder Tool</h4>
                        <p class="text-gray-600 mb-6">
                            Comprehensive testing of the create_reminder MCP tool functionality, demonstrating 
                            successful reminder creation workflow from voice input to database storage and calendar synchronization.
                        </p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Voice Interface Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Voice Interface</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                Voice-to-text transcription and reminder creation through the create_reminder MCP tool.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/reminder_twilio.png" 
                                     alt="Create Reminder Voice Interface Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="mb-3">
                                <audio controls class="w-full">
                                    <source src="/lgch_todo/static/assets/img/reminder.wav" type="audio/wav">
                                    Your browser does not support the audio element.
                                </audio>
                                <p class="text-xs text-gray-500 mt-1">Audio: "Create a reminder to call my wife ~~~~ at 2 PM"</p>
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Input:</strong> "Create a reminder to call my wife ~~~~ at 2 PM"<br>
                                <strong>Output:</strong> ‚úÖ Reminder created via voice
                            </div>
                        </div>
                        
                        <!-- Database Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Database Storage</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                create_reminder MCP tool successfully stores reminders in PostgreSQL database.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/reminder_db_table.png" 
                                     alt="Reminder Database Storage Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Process:</strong> MCP tool ‚Üí Database<br>
                                <strong>Result:</strong> ‚úÖ Reminder persisted in DB
                            </div>
                        </div>
                        
                        <!-- Calendar Sync Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Calendar Synchronization</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                create_reminder tool automatically syncs reminders to Google Calendar events.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/reminder_gc.png" 
                                     alt="Reminder Calendar Sync Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Process:</strong> Reminder ‚Üí Calendar Event<br>
                                <strong>Result:</strong> ‚úÖ Event created in Google Calendar
                            </div>
                        </div>
                        </div>
                    </div>
                    
                    <!-- Quaternary Test: Delete Reminder Tool -->
                    <div class="mb-8">
                        <h4 class="text-xl font-semibold mb-4 text-gray-800">4. Delete Reminder Tool</h4>
                        <p class="text-gray-600 mb-6">
                            Comprehensive testing of the delete_reminder MCP tool functionality, demonstrating 
                            successful reminder deletion workflow from voice input to database removal and calendar synchronization.
                        </p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Voice Interface Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Voice Interface</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                Voice-to-text transcription and reminder deletion through the delete_reminder MCP tool.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/delete_reminder_twilio.png" 
                                     alt="Delete Reminder Voice Interface Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="mb-3">
                                <audio controls class="w-full">
                                    <source src="/lgch_todo/static/assets/img/delete_reminder.wav" type="audio/wav">
                                    Your browser does not support the audio element.
                                </audio>
                                <p class="text-xs text-gray-500 mt-1">Audio: "Delete the reminder to call my wife"</p>
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Input:</strong> "Delete the reminder to call my wife"<br>
                                <strong>Output:</strong> ‚úÖ Reminder deleted via voice
                            </div>
                        </div>
                        
                        <!-- Database Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Database Removal</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                delete_reminder MCP tool successfully removes reminders from PostgreSQL database.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/delete_reminder_table.png" 
                                     alt="Delete Reminder Database Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Process:</strong> MCP tool ‚Üí Database Deletion<br>
                                <strong>Result:</strong> ‚úÖ Reminder removed from DB
                            </div>
                        </div>
                        
                        <!-- Calendar Sync Component -->
                        <div class="bg-gray-50 p-4 rounded border">
                            <h5 class="font-semibold text-gray-800 mb-3">Calendar Synchronization</h5>
                            <p class="text-sm text-gray-600 mb-3">
                                delete_reminder tool automatically removes corresponding Google Calendar events.
                            </p>
                            <div class="flex justify-center mb-3">
                                <img src="/lgch_todo/static/assets/img/delete_reminder_gc.png" 
                                     alt="Delete Reminder Calendar Sync Test Result" 
                                     class="max-w-full h-auto rounded-lg shadow-md border"
                                     style="max-width: 300px;">
                            </div>
                            <div class="text-xs text-gray-500">
                                <strong>Process:</strong> Reminder Deletion ‚Üí Calendar Event Removal<br>
                                <strong>Result:</strong> ‚úÖ Event removed from Google Calendar
                            </div>
                        </div>
                        </div>
                    </div>
                    
                    <!-- Test Summary -->
                    <div class="mt-8 bg-green-50 p-6 rounded-lg border-l-4 border-green-400">
                        <h4 class="font-semibold text-green-800 mb-3">‚úÖ MCP Tools - Complete Integration Test</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div>
                                <h5 class="font-medium text-green-700 mb-2">1. create_todo Tool Components</h5>
                                <ul class="text-sm text-green-600 space-y-1">
                                    <li>‚úÖ <strong>Voice Input Processing</strong> (Twilio Media Streams)</li>
                                    <li>‚úÖ <strong>Speech-to-Text</strong> (OpenAI Whisper)</li>
                                    <li>‚úÖ <strong>MCP Tool Execution</strong> (create_todo function)</li>
                                    <li>‚úÖ <strong>Database Storage</strong> (PostgreSQL)</li>
                                    <li>‚úÖ <strong>Calendar Sync</strong> (Google Calendar API)</li>
                        </ul>
                    </div>
                            <div>
                                <h5 class="font-medium text-green-700 mb-2">2. complete_todo Tool Components</h5>
                                <ul class="text-sm text-green-600 space-y-1">
                                    <li>‚úÖ <strong>Voice Input Processing</strong> (Twilio Media Streams)</li>
                                    <li>‚úÖ <strong>Speech-to-Text</strong> (OpenAI Whisper)</li>
                                    <li>‚úÖ <strong>MCP Tool Execution</strong> (complete_todo function)</li>
                                    <li>‚úÖ <strong>Database Update</strong> (PostgreSQL)</li>
                                    <li>‚úÖ <strong>Calendar Update</strong> (Google Calendar API)</li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-medium text-green-700 mb-2">3. create_reminder Tool Components</h5>
                                <ul class="text-sm text-green-600 space-y-1">
                                    <li>‚úÖ <strong>Voice Input Processing</strong> (Twilio Media Streams)</li>
                                    <li>‚úÖ <strong>Speech-to-Text</strong> (OpenAI Whisper)</li>
                                    <li>‚úÖ <strong>MCP Tool Execution</strong> (create_reminder function)</li>
                                    <li>‚úÖ <strong>Database Storage</strong> (PostgreSQL)</li>
                                    <li>‚úÖ <strong>Calendar Sync</strong> (Google Calendar API)</li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-medium text-green-700 mb-2">4. delete_reminder Tool Components</h5>
                                <ul class="text-sm text-green-600 space-y-1">
                                    <li>‚úÖ <strong>Voice Input Processing</strong> (Twilio Media Streams)</li>
                                    <li>‚úÖ <strong>Speech-to-Text</strong> (OpenAI Whisper)</li>
                                    <li>‚úÖ <strong>MCP Tool Execution</strong> (delete_reminder function)</li>
                                    <li>‚úÖ <strong>Database Removal</strong> (PostgreSQL)</li>
                                    <li>‚úÖ <strong>Calendar Sync</strong> (Google Calendar API)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 bg-blue-50 p-4 rounded border-l-4 border-blue-400">
                            <p class="text-sm text-blue-800">
                                <strong>create_todo Flow:</strong> Voice Input ‚Üí Speech-to-Text ‚Üí LangGraph Agent ‚Üí create_todo MCP Tool ‚Üí Database Storage ‚Üí Google Calendar Sync ‚Üí Text-to-Speech Response
                            </p>
                            <p class="text-sm text-blue-800 mt-2">
                                <strong>complete_todo Flow:</strong> Voice Input ‚Üí Speech-to-Text ‚Üí LangGraph Agent ‚Üí complete_todo MCP Tool ‚Üí Database Update ‚Üí Google Calendar Update ‚Üí Text-to-Speech Response
                            </p>
                            <p class="text-sm text-blue-800 mt-2">
                                <strong>create_reminder Flow:</strong> Voice Input ‚Üí Speech-to-Text ‚Üí LangGraph Agent ‚Üí create_reminder MCP Tool ‚Üí Database Storage ‚Üí Google Calendar Sync ‚Üí Text-to-Speech Response
                            </p>
                            <p class="text-sm text-blue-800 mt-2">
                                <strong>delete_reminder Flow:</strong> Voice Input ‚Üí Speech-to-Text ‚Üí LangGraph Agent ‚Üí delete_reminder MCP Tool ‚Üí Database Removal ‚Üí Google Calendar Removal ‚Üí Text-to-Speech Response
                            </p>
                        </div>
                        <div class="mt-4 bg-gray-50 p-4 rounded border">
                            <h5 class="font-medium text-gray-700 mb-2">Supporting Infrastructure</h5>
                            <ul class="text-sm text-gray-600 space-y-1 grid grid-cols-2 gap-x-4">
                                <li>‚úÖ LangGraph Agent Processing</li>
                                <li>‚úÖ Text-to-Speech (OpenAI TTS)</li>
                                <li>‚úÖ Call Recording System</li>
                                <li>‚úÖ WebSocket Communication</li>
                                <li>‚úÖ ngrok Tunnel Management</li>
                                <li>‚úÖ MCP Server Integration</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Performance Metrics -->
                    <div class="mt-6 bg-blue-50 p-6 rounded-lg border-l-4 border-blue-400">
                        <h4 class="font-semibold text-blue-800 mb-3">üìä Performance Metrics</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600">&lt; 2s</div>
                                <div class="text-sm text-blue-600">Response Time</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600">99.9%</div>
                                <div class="text-sm text-blue-600">Uptime</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600">100%</div>
                                <div class="text-sm text-blue-600">Test Pass Rate</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Back to Home -->
    <section class="py-8 bg-white">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <a href="{{ url_for('home') }}" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
                Back to Home
            </a>
        </div>
    </section>
</div>
{% endblock %}
